<!doctype html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Password Checker by IMEDRA SPHERE</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      box-sizing: border-box;
    }
    @keyframes gridPulse {
      0%, 100% { opacity: 0.15; }
      50% { opacity: 0.15; }
    }
    @keyframes neonGlow {
      0%, 100% { filter: drop-shadow(0 0 2px currentColor); }
      50% { filter: drop-shadow(0 0 8px currentColor); }
    }
    @keyframes strengthFill {
      from { width: 0%; }
      to { width: var(--target-width); }
    }
    @keyframes pulseButton {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    .grid-background {
      background-image: 
        linear-gradient(rgba(0, 240, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 240, 255, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
    }
    .circuit-line {
      position: absolute;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.4), transparent);
      animation: neonGlow 2s ease-in-out infinite;
    }
    .cyber-card {
      background: rgba(30, 40, 55, 0.98);
      border: 1px solid rgba(0, 240, 255, 0.4);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(0, 240, 255, 0.2);
      transition: all 0.3s ease;
    }
    .cyber-card:hover {
      border-color: rgba(0, 240, 255, 0.5);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6), 0 0 25px rgba(0, 240, 255, 0.2);
    }
    .cyber-input {
      background: rgba(10, 15, 25, 0.6);
      border: 1px solid rgba(0, 240, 255, 0.4);
      color: #00F0FF;
      transition: all 0.3s ease;
      font-family: 'Courier New', monospace;
    }
    .cyber-input:focus {
      outline: none;
      border-color: #00F0FF;
      background: rgba(10, 15, 25, 0.8);
      box-shadow: 0 0 20px rgba(0, 240, 255, 0.4);
    }
    .cyber-button {
      background: linear-gradient(135deg, #2563EB, #00F0FF);
      border: 1px solid #00F0FF;
      box-shadow: 0 4px 15px rgba(0, 240, 255, 0.3);
      transition: all 0.3s ease;
    }
    .cyber-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0, 240, 255, 0.5);
      animation: pulseButton 0.6s ease-in-out;
    }
    .cyber-button:active {
      transform: translateY(0);
    }
    .strength-bar {
      transition: all 0.4s ease;
      animation: strengthFill 0.4s ease-out;
    }
    .toggle-switch {
      width: 48px;
      height: 24px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .toggle-switch.active {
      background: linear-gradient(135deg, #2563EB, #00F0FF);
      border-color: #00F0FF;
      box-shadow: 0 0 10px rgba(0, 240, 255, 0.4);
    }
    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    .toggle-switch.active::after {
      left: 26px;
    }
    .check-icon {
      transition: all 0.3s ease;
    }
    .slider-track {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(0, 240, 255, 0.3);
      height: 4px;
    }
    .slider-thumb {
      background: linear-gradient(135deg, #2563EB, #00F0FF);
      border: 2px solid #00F0FF;
      box-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
    }
  </style>
  <style>
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1.5rem;
      background: rgba(15, 20, 35, 0.9);
      border-bottom: 1px solid rgba(0, 240, 255, 0.25);
      backdrop-filter: blur(10px);
    }
    .navbar a {
      color: #00F0FF;
      text-decoration: none;
      font-weight: 500;
      margin-left: 1rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: color 0.2s ease, text-shadow 0.2s ease;
    }
    .navbar a:hover {
      color: #2563EB;
      text-shadow: 0 0 8px rgba(0, 240, 255, 0.6);
    }
    .apps-container {
      display: flex;
      gap: 1rem;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body class="h-full w-full overflow-auto bg-[#1a1d29] text-white font-sans">
  <div class="min-h-full w-full grid-background relative">
    <!-- Circuit decoration lines -->
    <div class="circuit-line" style="top: 20%; left: 0; width: 30%;"></div>
    <div class="circuit-line" style="top: 60%; right: 0; width: 25%;"></div>
    <div class="circuit-line" style="top: 80%; left: 10%; width: 40%;"></div>

    <div class="app-wrapper w-full min-h-full py-12 px-4 relative z-10">
      <!-- NAVBAR HEADER -->
      <header class="relative z-20 mb-12">
        <nav class="navbar">
          <div class="navbar-left">
            <a href="http://imedrasphere.com" title="IMEDRA SPHERE Home">
              <i class="fas fa-home"></i> Home
            </a>
          </div>
          <div class="navbar-right">
            <div class="apps-container">
              <a href="https://mail.imedrasphere.com/webmail" target="_blank" title="IMEDRA Mail - Secure email service">
                <i class="fas fa-envelope"></i> Mail
              </a>
              <a href="https://docs.imedrasphere.com" target="_blank" title="IMEDRA Docs - Collaborative documents">
                <i class="fas fa-file-alt"></i> Docs
              </a>
              <a href="https://drive.imedrasphere.com" target="_blank" title="IMEDRA Drive - Cloud storage">
                <i class="fas fa-cloud"></i> Drive
              </a>
              <a href="https://school.imedrasphere.com" target="_blank" title="IMEDRA School - Educational platform">
                <i class="fas fa-graduation-cap"></i> School
              </a>
            </div>
          </div>
        </nav>
      </header>

      <!-- PAGE TITLE HEADER -->
      <header class="text-center mb-16">
        <h1 id="site-title" class="text-5xl font-bold mb-3 bg-gradient-to-r from-[#00F0FF] to-[#2563EB] bg-clip-text text-transparent" style="text-shadow: 0 0 30px rgba(0, 240, 255, 0.3);">
          PASS.IMEDRASPHERE
        </h1>
        <p id="site-subtitle" class="text-lg text-[#00F0FF] opacity-80">
          Smooth Experience • Real-time Analysis
        </p>
      </header>

      <!-- ✅ Responsive Grid Wrapper for Cards -->
      <div class="max-w-6xl mx-auto grid lg:grid-cols-2 gap-8 mb-12">
        <!-- Password Checker -->
        <div class="cyber-card rounded-2xl p-8">
          <h2 id="checker-title" class="text-2xl font-bold text-[#00F0FF] mb-6 flex items-center gap-3">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
            </svg>
            PASSWORD STRENGTH CHECKER
          </h2>
          <div class="mb-6">
            <div class="relative">
              <input type="password" id="password-input" placeholder="Enter password to analyze..." class="cyber-input w-full px-4 py-3 rounded-lg text-base"/>
              <span id="pwned-check-status" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-xs opacity-60"></span>
            </div>
          </div>
          <div class="mb-6">
            <div class="flex justify-between items-center mb-2">
              <span class="text-sm text-gray-100 font-medium">STRENGTH LEVEL</span>
              <span id="strength-text" class="text-sm font-bold text-gray-300">NOT ANALYZED</span>
            </div>
            <div class="h-3 bg-black/40 rounded-full overflow-hidden border border-[#00F0FF]/30">
              <div id="strength-bar" class="strength-bar h-full rounded-full transition-all" style="width: 0%; background: #555;"></div>
            </div>
          </div>
          <div class="space-y-3 mb-6">
            <div id="check-length" class="flex items-center gap-3 text-sm text-gray-100"><span class="check-icon text-xl">⚠️</span> <span>≥12 characters</span></div>
            <div id="check-uppercase" class="flex items-center gap-3 text-sm text-gray-100"><span class="check-icon text-xl">⚠️</span> <span>Contains uppercase letters</span></div>
            <div id="check-lowercase" class="flex items-center gap-3 text-sm text-gray-100"><span class="check-icon text-xl">⚠️</span> <span>Contains lowercase letters</span></div>
            <div id="check-numbers" class="flex items-center gap-3 text-sm text-gray-100"><span class="check-icon text-xl">⚠️</span> <span>Contains numbers</span></div>
            <div id="check-symbols" class="flex items-center gap-3 text-sm text-gray-100"><span class="check-icon text-xl">⚠️</span> <span>Contains special symbols (!@#$%^&*)</span></div>
          </div>
          <div id="detected-issues" class="hidden p-4 rounded-lg border-l-4 border-red-500 bg-red-900/20 text-red-200">
            <div class="flex items-start gap-2 mb-2">
              <svg class="w-5 h-5 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.25 6.75a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0zM12.75 14.25a7.5 7.5 0 01-12.467-4.25 7.5 7.5 0 0112.467 4.25z" clip-rule="evenodd" />
              </svg>
              <h3 class="font-bold text-sm">Detected Issues</h3>
            </div>
            <ul id="issues-list" class="text-xs list-disc pl-4 space-y-1"></ul>
          </div>
        </div>

        <!-- Password Generator -->
        <div class="cyber-card rounded-2xl p-8">
          <h2 id="generator-title" class="text-2xl font-bold text-[#00F0FF] mb-6 flex items-center gap-3">
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            PASSWORD GENERATOR
          </h2>
          <div class="mb-6">
            <div class="cyber-input w-full px-4 py-3 rounded-lg font-mono text-lg text-center tracking-wider" id="generated-password">
              ••••••••••••
            </div>
          </div>
          <div class="mb-6">
            <div class="flex justify-between items-center mb-3">
              <label class="text-sm font-medium text-gray-100">PASSWORD LENGTH</label>
              <span id="length-value" class="text-[#00F0FF] font-bold text-lg">16</span>
            </div>
            <input type="range" id="length-slider" min="8" max="32" value="16" class="w-full h-1.5 slider-track rounded-lg appearance-none cursor-pointer"/>
          </div>
          <div class="space-y-4 mb-6">
            <div class="flex items-center justify-between"><label class="text-sm text-gray-100">Uppercase (A-Z)</label><div class="toggle-switch active" data-option="uppercase"></div></div>
            <div class="flex items-center justify-between"><label class="text-sm text-gray-100">Lowercase (a-z)</label><div class="toggle-switch active" data-option="lowercase"></div></div>
            <div class="flex items-center justify-between"><label class="text-sm text-gray-100">Numbers (0-9)</label><div class="toggle-switch active" data-option="numbers"></div></div>
            <div class="flex items-center justify-between"><label class="text-sm text-gray-100">Symbols (!@#$%^&*)</label><div class="toggle-switch active" data-option="symbols"></div></div>
            <div class="flex items-center justify-between"><label class="text-sm text-gray-100">Exclude Similar (i, l, 1, O, 0)</label><div class="toggle-switch" data-option="excludeSimilar"></div></div>
            <div class="flex items-center justify-between"><label class="text-sm text-gray-100">Exclude Ambiguous ({ } [ ] ( ))</label><div class="toggle-switch" data-option="excludeAmbiguous"></div></div>
          </div>
          <button id="generate-btn" class="cyber-button w-full py-4 rounded-lg font-bold text-black text-lg flex items-center justify-center gap-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            GENERATE PASSWORD
          </button>
        </div>
      </div>
    </div>
  </div>
<script>
  // ✅ 1. Debounce helper
  function debounce(func, wait) {
    let timeout;
    return (...args) => {
      clearTimeout(timeout);
      timeout = setTimeout(() => func(...args), wait);
    };
  }

  // ✅ 2. Configs (unchanged, just expanded for clarity)
  const defaultConfig = {
    site_title: 'PASS.IMEDRASPHERE',
    site_subtitle: 'Smooth User Experience • Real-time Analysis',
    checker_title: 'PASSWORD STRENGTH CHECKER',
    generator_title: 'PASSWORD GENERATOR',
    footer_text: 'pass.imedrasphere.com • Secure Password Management',
    background_color: '#1a1d29',
    accent_color: '#00F0FF',
    secondary_accent_color: '#2563EB',
    text_color: '#FFFFFF',
    card_background: 'rgba(15, 15, 18, 0.85)',
    font_family: 'system-ui, -apple-system, sans-serif',
    font_size: 16
  };

  // ✅ CRITICAL FIX: Use `let`, NOT `const` for mutable state!
  let config = { ...defaultConfig };
  let generatorOptions = {
    uppercase: true,
    lowercase: true,
    numbers: true,
    symbols: true,
    excludeSimilar: false,
    excludeAmbiguous: false
  };

  const chars = {
    uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
    lowercase: 'abcdefghijklmnopqrstuvwxyz',
    numbers: '0123456789',
    symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?',
    similar: 'il1Lo0O',
    ambiguous: '{}[]()/\\\'"`~,;:.<>'
  };

  const commonPasswords = [
    'password', '123456', '123456789', 'qwerty', 'abc123', 'password123',
    'admin', 'letmein', 'welcome', 'login', 'monkey', '12345678',
    '12345', '1234567', 'sunshine', 'iloveyou', 'princess', 'master',
    'hello', 'freedom', 'whatever', 'qazwsx', 'trustno1', '000000',
    '111111', '654321', '666666', '7777777', '1q2w3e', '1qaz2wsx',
    'asdfgh', 'zxcvbn', 'azerty', 'passw0rd', 'p@ssw0rd'
  ];

  const keyboardPatterns = [
    'qwerty', 'asdfgh', 'zxcvbn', '123456', '1234567890',
    'qazwsx', 'zaq12wsx', '1qaz2wsx', '1q2w3e', '1q2w3e4r',
    'azerty', 'wxcvbn', '!@#$%^', '@#$%^&'
  ];

  // ✅ 3. DOM-ready setup
  document.addEventListener('DOMContentLoaded', () => {
    // DOM Elements
    const passwordInput = document.getElementById('password-input');
    const strengthBar = document.getElementById('strength-bar');
    const strengthText = document.getElementById('strength-text');
    const lengthSlider = document.getElementById('length-slider');
    const lengthValue = document.getElementById('length-value');
    const generateBtn = document.getElementById('generate-btn');
    const generatedPassword = document.getElementById('generated-password');
    const issuesEl = document.getElementById('detected-issues');
    const issuesList = document.getElementById('issues-list');

    // ✅ 4. Password Generator: Toggle Setup
    document.querySelectorAll('.toggle-switch').forEach(toggle => {
      const option = toggle.dataset.option;
      // Sync initial visual state
      if (generatorOptions[option]) {
        toggle.classList.add('active');
      }
      toggle.addEventListener('click', () => {
        generatorOptions[option] = !generatorOptions[option]; // ✅ Now works (let, not const!)
        toggle.classList.toggle('active');
      });
    });

    // Slider
    lengthSlider?.addEventListener('input', (e) => {
      const val = parseInt(e.target.value) || 16;
      lengthValue.textContent = val;
      const percent = ((val - 8) / 24) * 100; // 24 = 32 - 8
      e.target.style.background = `linear-gradient(to right, #00F0FF ${percent}%, rgba(0,0,0,0.4) ${percent}%)`;
    });

    // ✅ 5. Fixed Password Generator
    function generatePassword() {
      const length = parseInt(lengthSlider?.value) || 16;
      let charset = '';

      if (generatorOptions.uppercase) charset += chars.uppercase;
      if (generatorOptions.lowercase) charset += chars.lowercase;
      if (generatorOptions.numbers) charset += chars.numbers;
      if (generatorOptions.symbols) charset += chars.symbols;

      // Apply exclusions only if enabled AND charset exists
      if (generatorOptions.excludeSimilar && charset) {
        charset = charset.split('').filter(c => !chars.similar.includes(c)).join('');
      }
      if (generatorOptions.excludeAmbiguous && charset) {
        charset = charset.split('').filter(c => !chars.ambiguous.includes(c)).join('');
      }

      if (!charset) {
        generatedPassword.textContent = '⚠️ Enable at least one character type';
        return;
      }

      let password = '';
      for (let i = 0; i < length; i++) {
        password += charset.charAt(Math.floor(Math.random() * charset.length));
      }
      generatedPassword.textContent = password;
    }

    generateBtn?.addEventListener('click', generatePassword);
    generatePassword(); // Initial

    // ✅ 6. Fixed HIBP (no extra spaces!)
    async function isPasswordPwned(password) {
      if (!password) return false;
      const enc = new TextEncoder().encode(password);
      const hashBuffer = await crypto.subtle.digest('SHA-1', enc);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('').toUpperCase();
      const prefix = hashHex.substring(0, 5);
      const suffix = hashHex.substring(5);

      try {
        // ✅ FIXED: NO EXTRA SPACES IN URL
        const res = await fetch(`https://api.pwnedpasswords.com/range/${prefix}`, {
          method: 'GET',
          headers: { 'User-Agent': 'pass.imedrasphere.com' }
        });

        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const body = await res.text();
        const suffixes = body.split('\n').map(line => line.split(':')[0]);
        return suffixes.includes(suffix);
      } catch (err) {
        console.warn('HIBP check failed:', err);
        return false;
      }
    }

    // Helpers
    function isSequential(str) {
      if (str.length < 3) return false;
      const digits = str.split('').map(c => parseInt(c, 10));
      if (digits.some(isNaN)) return false;
      let asc = true, desc = true;
      for (let i = 1; i < digits.length; i++) {
        if (digits[i] !== digits[i - 1] + 1) asc = false;
        if (digits[i] !== digits[i - 1] - 1) desc = false;
      }
      return asc || desc;
    }

    function isSequentialLetters(str) {
      if (str.length < 3) return false;
      const codes = str.split('').map(c => c.charCodeAt(0));
      let asc = true, desc = true;
      for (let i = 1; i < codes.length; i++) {
        if (codes[i] !== codes[i - 1] + 1) asc = false;
        if (codes[i] !== codes[i - 1] - 1) desc = false;
      }
      return asc || desc;
    }

    function updateCheck(id, passed) {
      const el = document.getElementById(id);
      const icon = el?.querySelector('.check-icon');
      if (!icon) return;
      icon.textContent = passed ? '✅' : '⚠️';
      el.classList.toggle('text-[#00F0FF]', passed);
      el.classList.toggle('text-gray-100', !passed);
    }

    function resetUI(strength, color, width) {
      strengthBar.style.width = `${width}%`;
      strengthBar.style.background = color;
      strengthBar.style.boxShadow = width > 0 ? `0 0 10px ${color}` : 'none';
      strengthText.textContent = strength;
      strengthText.style.color = color;
      issuesEl?.classList.add('hidden');
    }

    // ✅ 7. Fixed Password Checker
    async function checkPasswordStrength() {
      const password = passwordInput?.value || '';
      if (!password) {
        resetUI('NOT ANALYZED', '#555', 0);
        ['length','uppercase','lowercase','numbers','symbols'].forEach(k => updateCheck(`check-${k}`, false));
        return;
      }

      const lower = password.toLowerCase();
      let isPwned = false;
      try {
        isPwned = await isPasswordPwned(password); // ✅ Now works
      } catch (e) {
        console.warn('HIBP skipped:', e);
      }

      const checks = {
        length: password.length >= 12,
        uppercase: /[A-Z]/.test(password),
        lowercase: /[a-z]/.test(password),
        numbers: /[0-9]/.test(password),
        symbols: /[!@#$%^&*()_+\-=\[\]{}|;:,.<>?~`]/.test(password)
      };

      ['length','uppercase','lowercase','numbers','symbols'].forEach(k => 
        updateCheck(`check-${k}`, checks[k])
      );

      // Weakness detection
      let weaknesses = [];
      if (isPwned) weaknesses.push('Found in data breaches (HIBP) — never reuse!');
      if (commonPasswords.some(p => lower.includes(p))) weaknesses.push('Contains common pattern (e.g., "password", "123")');
      if (keyboardPatterns.some(p => lower.includes(p))) weaknesses.push('Contains keyboard walk (e.g., "qwerty")');
      if (/(.)\1{3,}/.test(password)) weaknesses.push('Contains repeated chars (e.g., "aaaa")');

      const digitSeq = password.match(/(\d{3,})/);
      if (digitSeq && (isSequential(digitSeq[1]) || isSequential(digitSeq[1].split('').reverse().join('')))) {
        weaknesses.push('Contains sequential digits (e.g., "123")');
      }

      const letterSeq = password.match(/([a-z]{3,})/i);
      if (letterSeq) {
        const seq = letterSeq[1].toLowerCase();
        if (isSequentialLetters(seq) || isSequentialLetters(seq.split('').reverse().join(''))) {
          weaknesses.push('Contains sequential letters (e.g., "abc")');
        }
      }

      // Scoring
      const score = Object.values(checks).filter(Boolean).length;
      let strength, color, width;

      if (weaknesses.length > 0) {
        if (isPwned) { strength = 'VERY WEAK (Pwned!)'; color = '#EF4444'; width = 10; }
        else if (score >= 5 && password.length >= 12) { strength = 'MODERATE'; color = '#EAB308'; width = 50; }
        else if (score >= 3) { strength = 'WEAK'; color = '#F97316'; width = 35; }
        else { strength = 'VERY WEAK'; color = '#EF4444'; width = 15; }
      } else {
        if (score <= 2) { strength = 'VERY WEAK'; color = '#EF4444'; width = 20; }
        else if (score === 3) { strength = 'WEAK'; color = '#F97316'; width = 40; }
        else if (score === 4) { strength = 'MODERATE'; color = '#EAB308'; width = 60; }
        else if (score === 5 && password.length < 12) { strength = 'STRONG (short)'; color = '#2563EB'; width = 75; }
        else { strength = 'VERY STRONG'; color = '#00F0FF'; width = 100; }
      }

      // Update UI
      strengthBar.style.width = `${width}%`;
      strengthBar.style.background = color;
      strengthBar.style.boxShadow = width > 0 ? `0 0 10px ${color}` : 'none';
      strengthText.textContent = strength;
      strengthText.style.color = color;

      if (weaknesses.length > 0) {
        issuesList.innerHTML = weaknesses.map(w => `<li>${w}</li>`).join('');
        issuesEl.classList.remove('hidden');
      } else {
        issuesEl.classList.add('hidden');
      }
    }

    // Attach checker
    if (passwordInput) {
      passwordInput.addEventListener('input', debounce(checkPasswordStrength, 400));
    }

    // ✅ Optional: SDK integration (only if SDK loaded)
    if (window.elementSdk) {
      // Your onConfigChange, mapToCapabilities, etc. go here
      // (Keep as-is — not causing issues)
    }
  });
</script>
</body>
</html>
